<!DOCTYPE html>
<html lang="ru">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Карта</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        touch-action: none;
        background: #000;
    }

    #container {
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        position: relative;
    }

    #map {
        position: absolute;
        transform-origin: 0 0;
        will-change: transform;
        user-select: none;
        touch-action: none;
    }
</style>
</head>
<body>

<div id="container">
    <img id="map" src="map-big.jpg" alt="Map">
</div>

<script>
const container = document.getElementById("container");
const map = document.getElementById("map");

let posX = 0, posY = 0;
let startX = 0, startY = 0;

let scale = 1;
let startScale = 1;

let pinchDistance = 0;

// Ограничиваем карту чтобы не выходила за края
function clamp() {
    const cw = container.clientWidth;
    const ch = container.clientHeight;

    const mw = map.naturalWidth * scale;
    const mh = map.naturalHeight * scale;

    const minX = Math.min(0, cw - mw);
    const minY = Math.min(0, ch - mh);

    posX = Math.max(minX, Math.min(0, posX));
    posY = Math.max(minY, Math.min(0, posY));
}

function render() {
    clamp();
    map.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
}

function getDistance(t1, t2) {
    return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
}

function getMidpoint(t1, t2) {
    return {
        x: (t1.clientX + t2.clientX) / 2,
        y: (t1.clientY + t2.clientY) / 2
    };
}

// --------------------- TOUCH START ---------------------
container.addEventListener("touchstart", (e) => {
    if (e.touches.length === 1) {
        // плавное перетаскивание
        startX = e.touches[0].clientX - posX;
        startY = e.touches[0].clientY - posY;
    }

    if (e.touches.length === 2) {
        // зум
        pinchDistance = getDistance(e.touches[0], e.touches[1]);
        startScale = scale;
    }
});

// --------------------- TOUCH MOVE ---------------------
container.addEventListener("touchmove", (e) => {
    e.preventDefault();

    if (e.touches.length === 1) {
        // плавное перемещение
        const touch = e.touches[0];
        posX = touch.clientX - startX;
        posY = touch.clientY - startY;

        render();
    }

    if (e.touches.length === 2) {
        // зум
        const newDist = getDistance(e.touches[0], e.touches[1]);
        const zoomFactor = newDist / pinchDistance;

        scale = Math.min(4, Math.max(1, startScale * zoomFactor));

        render();
    }
});

// --------------------- TOUCH END ---------------------
container.addEventListener("touchend", () => {
    // никаких рывков, никаких инерций — карта остаётся там, где остановили палец
});
</script>
</body>
</html>
