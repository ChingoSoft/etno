<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Карта без инерции</title>
<style>
  html, body { margin:0; padding:0; height:100%; overflow:hidden; }
  body { background:#111; touch-action:none; user-select:none; }

  #wrapper {
    position:relative;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#000;
  }

  #map {
    position:absolute;
    left:0;
    top:0;
    will-change:transform;
    transform-origin:0 0;
  }

  #map img {
    max-width:none;
    pointer-events:none;
    user-drag:none;
  }
</style>
</head>
<body>

<div id="wrapper">
  <div id="map">
    <img id="mapImg" src="big-map.jpg" alt="">
  </div>
</div>

<script>
(function() {
  const wrapper = document.getElementById("wrapper");
  const mapEl = document.getElementById("map");
  const img = document.getElementById("mapImg");

  let pos = { x:0, y:0 };
  let dragStart = { x:0, y:0 };
  let mapStart = { x:0, y:0 };

  let scale = 1;
  let minScale = 1;
  let maxScale = 4;

  let pinchStartDist = 0;
  let pinchStartScale = 1;

  // -----------------------------
  // APPLY TRANSFORM
  // -----------------------------
  function apply() {
    mapEl.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
  }

  // -----------------------------
  // LIMIT BOUNDS
  // -----------------------------
  function clamp() {
    const w = wrapper.clientWidth;
    const h = wrapper.clientHeight;

    const mapW = img.naturalWidth * scale;
    const mapH = img.naturalHeight * scale;

    if (mapW <= w) pos.x = (w - mapW) / 2;
    else pos.x = Math.min(0, Math.max(pos.x, w - mapW));

    if (mapH <= h) pos.y = (h - mapH) / 2;
    else pos.y = Math.min(0, Math.max(pos.y, h - mapH));
  }

  // -----------------------------
  // TOUCH START
  // -----------------------------
  wrapper.addEventListener("touchstart", e => {
    if (e.touches.length === 1) {
      // движение одним пальцем
      const t = e.touches[0];
      dragStart.x = t.clientX;
      dragStart.y = t.clientY;

      mapStart.x = pos.x;
      mapStart.y = pos.y;
    }

    if (e.touches.length === 2) {
      // pinch zoom
      const [t1, t2] = e.touches;
      pinchStartDist = Math.hypot(
        t1.clientX - t2.clientX,
        t1.clientY - t2.clientY
      );
      pinchStartScale = scale;
    }
  }, { passive:false });

  // -----------------------------
  // TOUCH MOVE
  // -----------------------------
  wrapper.addEventListener("touchmove", e => {
    e.preventDefault();

    // PINCH ZOOM
    if (e.touches.length === 2) {
      const [t1, t2] = e.touches;

      // центр pinch-жеста
      const centerX = (t1.clientX + t2.clientX) / 2;
      const centerY = (t1.clientY + t2.clientY) / 2;

      // точка карты под пальцами (до масштабирования)
      const mapPointX = (centerX - pos.x) / scale;
      const mapPointY = (centerY - pos.y) / scale;

      // новая величина масштаба
      const dist = Math.hypot(
        t1.clientX - t2.clientX,
        t1.clientY - t2.clientY
      );

      let newScale = pinchStartScale * (dist / pinchStartDist);
      newScale = Math.min(maxScale, Math.max(minScale, newScale));

      // корректируем позицию, чтобы точка под пальцами не «убежала»
      pos.x = centerX - mapPointX * newScale;
      pos.y = centerY - mapPointY * newScale;

      scale = newScale;
      clamp();
      apply();
      return;
    }

    // DRAG (один палец)
    if (e.touches.length === 1) {
      const t = e.touches[0];

      pos.x = mapStart.x + (t.clientX - dragStart.x);
      pos.y = mapStart.y + (t.clientY - dragStart.y);

      clamp();
      apply();
    }
  }, { passive:false });

  // -----------------------------
  // TOUCH END
  // -----------------------------
  wrapper.addEventListener("touchend", () => {
    // никаких инерций, карта остаётся ровно там, где палец отпущен
  });

  // -----------------------------
  // INITIAL CENTERING
  // -----------------------------
  img.onload = () => {
    const w = wrapper.clientWidth;
    const h = wrapper.clientHeight;

    const sw = w / img.naturalWidth;
    const sh = h / img.naturalHeight;

    scale = Math.max(sw, sh);
    minScale = scale;

    const mapW = img.naturalWidth * scale;
    const mapH = img.naturalHeight * scale;

    pos.x = (w - mapW) / 2;
    pos.y = (h - mapH) / 2;

    apply();
  };

})();
</script>

</body>
</html>
